[platformio]
default_envs = esp32-s3-devkitc-1
description = Marvin-4: ESP32-S3 Wake Word Detection System with Voice Commands

[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
upload_speed = 921600

; Enhanced build flags for ESP32-S3 optimization
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DCONFIG_ARDUINO_LOOP_STACK_SIZE=16384
    -Iinclude/
    -DBOARD_HAS_PSRAM
    ; Memory optimizations
    -DCONFIG_ARDUINO_ISR_IRAM=1
    ; Compiler optimizations
    -O2
    -ffast-math

; Required libraries
lib_deps = 
    kosme/arduinoFFT@^2.0.4
    adafruit/Adafruit AHTX0@^2.0.5
    adafruit/Adafruit Unified Sensor@^1.1.14

; Board configuration optimized for N16R8
board_build.flash_size = 16MB
board_build.flash_mode = qio
board_build.psram_type = opi

; Use default partition table that supports 16MB
board_build.partitions = huge_app.csv

; Monitor settings
monitor_filters = 
    esp32_exception_decoder
    time
    colorize

; Build optimization
build_type = release
build_unflags = 
    -Os

; Development environment for debugging
[env:debug]
extends = env:esp32-s3-devkitc-1
build_type = debug
build_flags = 
    ${env:esp32-s3-devkitc-1.build_flags}
    -DDEBUG_ESP_PORT=Serial
    -DDEBUG_ESP_CORE
monitor_filters = 
    ${env:esp32-s3-devkitc-1.monitor_filters}
    default